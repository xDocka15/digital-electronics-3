\hypertarget{a00046}{}\doxysubsection{T\+WI Library $<$twi.\+h$>$}
\label{a00046}\index{TWI Library $<$twi.h$>$@{TWI Library $<$twi.h$>$}}


I2\+C/\+T\+WI library for A\+V\+R-\/\+G\+CC.  


\doxysubsubsection*{Definition of frequencies}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{a00046_ga43bafb28b29491ec7f871319b5a3b2f8}\label{a00046_ga43bafb28b29491ec7f871319b5a3b2f8}} 
\#define \mbox{\hyperlink{a00046_ga43bafb28b29491ec7f871319b5a3b2f8}{F\+\_\+\+C\+PU}}~16000000
\begin{DoxyCompactList}\small\item\em C\+PU frequency in Hz required T\+W\+I\+\_\+\+B\+I\+T\+\_\+\+R\+A\+T\+E\+\_\+\+R\+EG. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{a00046_ga7a1c522bed64982971384489ee477bd3}\label{a00046_ga7a1c522bed64982971384489ee477bd3}} 
\#define \mbox{\hyperlink{a00046_ga7a1c522bed64982971384489ee477bd3}{F\+\_\+\+S\+CL}}~50000
\begin{DoxyCompactList}\small\item\em I2\+C/\+T\+WI bit rate. Must be greater than 31000. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{a00046_ga801c158406ca2334b446e442a2debe37}\label{a00046_ga801c158406ca2334b446e442a2debe37}} 
\#define \mbox{\hyperlink{a00046_ga801c158406ca2334b446e442a2debe37}{T\+W\+I\+\_\+\+B\+I\+T\+\_\+\+R\+A\+T\+E\+\_\+\+R\+EG}}~((\mbox{\hyperlink{a00046_ga43bafb28b29491ec7f871319b5a3b2f8}{F\+\_\+\+C\+PU}}/\mbox{\hyperlink{a00046_ga7a1c522bed64982971384489ee477bd3}{F\+\_\+\+S\+CL}} -\/ 16) / 2)
\begin{DoxyCompactList}\small\item\em T\+WI bit rate register value. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Definition of ports and pins}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{a00046_ga762c164f4acd04d3ce3627fe73e7c018}\label{a00046_ga762c164f4acd04d3ce3627fe73e7c018}} 
\#define \mbox{\hyperlink{a00046_ga762c164f4acd04d3ce3627fe73e7c018}{T\+W\+I\+\_\+\+P\+O\+RT}}~P\+O\+R\+TC
\begin{DoxyCompactList}\small\item\em Port of T\+WI unit. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{a00046_ga3f14ed8491293d0dda1372cceaa39851}\label{a00046_ga3f14ed8491293d0dda1372cceaa39851}} 
\#define \mbox{\hyperlink{a00046_ga3f14ed8491293d0dda1372cceaa39851}{T\+W\+I\+\_\+\+S\+D\+A\+\_\+\+P\+IN}}~4
\begin{DoxyCompactList}\small\item\em S\+DA pin of T\+WI unit. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{a00046_gac0ad8b33f1be48e211f1eeae2dd65cee}\label{a00046_gac0ad8b33f1be48e211f1eeae2dd65cee}} 
\#define \mbox{\hyperlink{a00046_gac0ad8b33f1be48e211f1eeae2dd65cee}{T\+W\+I\+\_\+\+S\+C\+L\+\_\+\+P\+IN}}~5
\begin{DoxyCompactList}\small\item\em S\+CL pin of T\+WI unit. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Other definitions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{a00046_ga16f0e6b2fa5a26eadbf4086ab6d54467}{twi\+\_\+init}} (void)
\begin{DoxyCompactList}\small\item\em Initialize T\+WI unit, enable internal pull-\/ups, and set S\+CL frequency. \end{DoxyCompactList}\item 
uint8\+\_\+t \mbox{\hyperlink{a00046_gab91653c870898cdb13d9ac0f29ed6629}{twi\+\_\+start}} (uint8\+\_\+t address, uint8\+\_\+t mode)
\begin{DoxyCompactList}\small\item\em Start communication on I2\+C/\+T\+WI bus and send address byte. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{a00046_gab45679e1a7b3b8f97b636d825e7d14f7}{twi\+\_\+write}} (uint8\+\_\+t data)
\begin{DoxyCompactList}\small\item\em Send one data byte to I2\+C/\+T\+WI Slave device. \end{DoxyCompactList}\item 
uint8\+\_\+t \mbox{\hyperlink{a00046_ga7a2cd23dea30ee2c99c1ccffb3402d79}{twi\+\_\+read\+\_\+ack}} (void)
\begin{DoxyCompactList}\small\item\em Read one byte from the I2\+C/\+T\+WI Slave device and acknowledge it with A\+CK, i.\+e. communication will continue. \end{DoxyCompactList}\item 
uint8\+\_\+t \mbox{\hyperlink{a00046_gaa21e972557bab9a799720874660cf152}{twi\+\_\+read\+\_\+nack}} (void)
\begin{DoxyCompactList}\small\item\em Read one byte from the I2\+C/\+T\+WI Slave device and acknowledge it with N\+A\+CK, i.\+e. communication will not continue. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{a00046_gacf52d6c93df110dee6d402b389e5042e}{twi\+\_\+stop}} (void)
\begin{DoxyCompactList}\small\item\em Generates stop condition on I2\+C/\+T\+WI bus. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{a00046_gaaf9a8abccd811954f9cc316f2b2f87b3}\label{a00046_gaaf9a8abccd811954f9cc316f2b2f87b3}} 
\#define \mbox{\hyperlink{a00046_gaaf9a8abccd811954f9cc316f2b2f87b3}{T\+W\+I\+\_\+\+R\+E\+AD}}~1
\begin{DoxyCompactList}\small\item\em Mode for reading from I2\+C/\+T\+WI device. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{a00046_ga3b68e8e777b71520f9dbfac733774d5f}\label{a00046_ga3b68e8e777b71520f9dbfac733774d5f}} 
\#define \mbox{\hyperlink{a00046_ga3b68e8e777b71520f9dbfac733774d5f}{T\+W\+I\+\_\+\+W\+R\+I\+TE}}~0
\begin{DoxyCompactList}\small\item\em Mode for writing to I2\+C/\+T\+WI device. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{a00046_ga6c0346728feb274834cad94daca316ee}\label{a00046_ga6c0346728feb274834cad94daca316ee}} 
\#define \mbox{\hyperlink{a00046_ga6c0346728feb274834cad94daca316ee}{D\+DR}}(\+\_\+x)~($\ast$(\&\+\_\+x -\/ 1))
\begin{DoxyCompactList}\small\item\em Define address of Data Direction Register of port \+\_\+x. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{a00046_ga740f9eb9c9f9e33500ee61ec53945f6a}\label{a00046_ga740f9eb9c9f9e33500ee61ec53945f6a}} 
\#define \mbox{\hyperlink{a00046_ga740f9eb9c9f9e33500ee61ec53945f6a}{P\+IN}}(\+\_\+x)~($\ast$(\&\+\_\+x -\/ 2))
\begin{DoxyCompactList}\small\item\em Define address of input register of port \+\_\+x. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsubsection{Detailed Description}
I2\+C/\+T\+WI library for A\+V\+R-\/\+G\+CC. 


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00023}{twi.h}}>} }
\end{DoxyCode}


This library defines functions for the T\+WI (I2C) communication between A\+VR and Slave device(s). Functions use internal T\+WI module of A\+VR.

\begin{DoxyNote}{Note}
Based on Microchip Atmel A\+Tmega16 and A\+Tmega328P manuals. 
\end{DoxyNote}
\begin{DoxyAuthor}{Author}
Tomas Fryza, Dept. of Radio Electronics, Brno University of Technology, Czechia 
\end{DoxyAuthor}
\begin{DoxyCopyright}{Copyright}
(c) 2018 Tomas Fryza, This work is licensed under the terms of the M\+IT license 
\end{DoxyCopyright}


\doxysubsubsection{Function Documentation}
\mbox{\Hypertarget{a00046_ga16f0e6b2fa5a26eadbf4086ab6d54467}\label{a00046_ga16f0e6b2fa5a26eadbf4086ab6d54467}} 
\index{TWI Library $<$twi.h$>$@{TWI Library $<$twi.h$>$}!twi\_init@{twi\_init}}
\index{twi\_init@{twi\_init}!TWI Library $<$twi.h$>$@{TWI Library $<$twi.h$>$}}
\doxyparagraph{\texorpdfstring{twi\_init()}{twi\_init()}}
{\footnotesize\ttfamily void twi\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Initialize T\+WI unit, enable internal pull-\/ups, and set S\+CL frequency. 

\begin{DoxyParagraph}{Implementation notes\+:}

\begin{DoxyItemize}
\item A\+VR internal pull-\/up resistors at pins T\+W\+I\+\_\+\+S\+D\+A\+\_\+\+P\+IN and T\+W\+I\+\_\+\+S\+C\+L\+\_\+\+P\+IN are enabled
\item T\+WI bit rate register value is calculated as follows fscl = fcpu/(16 + 2$\ast$\+T\+W\+BR) 
\end{DoxyItemize}
\end{DoxyParagraph}
\begin{DoxyReturn}{Returns}
none 
\end{DoxyReturn}
\mbox{\Hypertarget{a00046_ga7a2cd23dea30ee2c99c1ccffb3402d79}\label{a00046_ga7a2cd23dea30ee2c99c1ccffb3402d79}} 
\index{TWI Library $<$twi.h$>$@{TWI Library $<$twi.h$>$}!twi\_read\_ack@{twi\_read\_ack}}
\index{twi\_read\_ack@{twi\_read\_ack}!TWI Library $<$twi.h$>$@{TWI Library $<$twi.h$>$}}
\doxyparagraph{\texorpdfstring{twi\_read\_ack()}{twi\_read\_ack()}}
{\footnotesize\ttfamily uint8\+\_\+t twi\+\_\+read\+\_\+ack (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Read one byte from the I2\+C/\+T\+WI Slave device and acknowledge it with A\+CK, i.\+e. communication will continue. 

\begin{DoxyReturn}{Returns}
Received data byte 
\end{DoxyReturn}
\mbox{\Hypertarget{a00046_gaa21e972557bab9a799720874660cf152}\label{a00046_gaa21e972557bab9a799720874660cf152}} 
\index{TWI Library $<$twi.h$>$@{TWI Library $<$twi.h$>$}!twi\_read\_nack@{twi\_read\_nack}}
\index{twi\_read\_nack@{twi\_read\_nack}!TWI Library $<$twi.h$>$@{TWI Library $<$twi.h$>$}}
\doxyparagraph{\texorpdfstring{twi\_read\_nack()}{twi\_read\_nack()}}
{\footnotesize\ttfamily uint8\+\_\+t twi\+\_\+read\+\_\+nack (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Read one byte from the I2\+C/\+T\+WI Slave device and acknowledge it with N\+A\+CK, i.\+e. communication will not continue. 

\begin{DoxyReturn}{Returns}
Received data byte 
\end{DoxyReturn}
\mbox{\Hypertarget{a00046_gab91653c870898cdb13d9ac0f29ed6629}\label{a00046_gab91653c870898cdb13d9ac0f29ed6629}} 
\index{TWI Library $<$twi.h$>$@{TWI Library $<$twi.h$>$}!twi\_start@{twi\_start}}
\index{twi\_start@{twi\_start}!TWI Library $<$twi.h$>$@{TWI Library $<$twi.h$>$}}
\doxyparagraph{\texorpdfstring{twi\_start()}{twi\_start()}}
{\footnotesize\ttfamily uint8\+\_\+t twi\+\_\+start (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{address,  }\item[{uint8\+\_\+t}]{mode }\end{DoxyParamCaption})}



Start communication on I2\+C/\+T\+WI bus and send address byte. 


\begin{DoxyParams}{Parameters}
{\em address} & Slave address \\
\hline
{\em mode} & T\+W\+I\+\_\+\+R\+E\+AD or T\+W\+I\+\_\+\+W\+R\+I\+TE \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 0} & -\/ Slave device accessible \\
\hline
{\em 1} & -\/ Failed to access Slave device \\
\hline
\end{DoxyRetVals}
\begin{DoxyNote}{Note}
Function returns 0 only if 0x18 or 0x40 status code is detected~\newline
 0x18\+: S\+L\+A+W has been transmitted and A\+CK has been received~\newline
 0x40\+: S\+L\+A+R has been transmitted and A\+CK has been received~\newline

\end{DoxyNote}
\mbox{\Hypertarget{a00046_gacf52d6c93df110dee6d402b389e5042e}\label{a00046_gacf52d6c93df110dee6d402b389e5042e}} 
\index{TWI Library $<$twi.h$>$@{TWI Library $<$twi.h$>$}!twi\_stop@{twi\_stop}}
\index{twi\_stop@{twi\_stop}!TWI Library $<$twi.h$>$@{TWI Library $<$twi.h$>$}}
\doxyparagraph{\texorpdfstring{twi\_stop()}{twi\_stop()}}
{\footnotesize\ttfamily void twi\+\_\+stop (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Generates stop condition on I2\+C/\+T\+WI bus. 

\begin{DoxyReturn}{Returns}
none 
\end{DoxyReturn}
\mbox{\Hypertarget{a00046_gab45679e1a7b3b8f97b636d825e7d14f7}\label{a00046_gab45679e1a7b3b8f97b636d825e7d14f7}} 
\index{TWI Library $<$twi.h$>$@{TWI Library $<$twi.h$>$}!twi\_write@{twi\_write}}
\index{twi\_write@{twi\_write}!TWI Library $<$twi.h$>$@{TWI Library $<$twi.h$>$}}
\doxyparagraph{\texorpdfstring{twi\_write()}{twi\_write()}}
{\footnotesize\ttfamily void twi\+\_\+write (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{data }\end{DoxyParamCaption})}



Send one data byte to I2\+C/\+T\+WI Slave device. 


\begin{DoxyParams}{Parameters}
{\em data} & Byte to be transmitted \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
none 
\end{DoxyReturn}
